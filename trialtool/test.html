<html>
    <head>
        <title>Test Page</title>
    </head>
    <body>
        <div id = "console">
        </div>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.5.1/jquery.min.js" type="text/javascript">
        </script>
        <script type = "text/javascript" src = "/trialtool/js/ConsoleHelper.js">
        </script>
        <script type = "text/javascript">
            function axe(){
            	/*Pre Requisites*/
            	
            	// Initialising the window.IndexedDB Object
            	window.indexedDB = window.indexedDB || window.mozIndexedDB || window.webkitIndexedDB;
            	window.IDBKeyRange = window.IDBKeyRange || window.webkitIDBKeyRange;
            	window.IDBTransaction = window.IDBTransaction || window.webkitIDBTransaction;
            	var DAO = DAO || {};
            	
            	
            	
            	/*Open DB with version+1*/
            	
            	var version = 1;
            	var db = null;
            	document.write("Trying to open database with version", version);
            	try {
            		var dbOpenRequest = window.indexedDB.open("BookShop1", version);
            		dbOpenRequest.onsuccess = function(event){
            			db = dbOpenRequest.result;
            			DAO.version = db.version;
            			db.onversionchange = function(e){
            				write("Version change triggered, so closing database connection", e.oldVersion, e.newVersion, db);
            				db.close();
            			};
            			write("Database Opened", db, event);
            			/* Code for ${db.open} */
            		};
            		dbOpenRequest.onupgradeneeded = function(e){
            			write("Database upgrade needed");
            			var db = dbOpenRequest.result;
            			
            			write("Changing the database version");
            			// db has been initialized elsewhere                                    
            			try {
            				var objectStore = db.createObjectStore("ObjectStore_BookList", {
            					"keyPath": "id",
            					"autoIncrement": true
            				});
            				write("Object Store created", objectStore);
            			} catch (e) {
            				writeError(e);
            			}
            			
            		};
            		dbOpenRequest.onerror = function(e){
            			write("DB Open Request Error");
            		};
            		dbOpenRequest.onblocked = function(e){
            			write("DB Open Request Blocked");
            		};
            	} catch (e) {
            		writeError(e);
            	}
            }
            
            function axe1(){
            	/*Pre Requisites*/
            	
            	// Initialising the window.IndexedDB Object
            	window.indexedDB = window.indexedDB || window.mozIndexedDB || window.webkitIndexedDB;
            	window.IDBKeyRange = window.IDBKeyRange || window.webkitIDBKeyRange;
            	window.IDBTransaction = window.IDBTransaction || window.webkitIDBTransaction;
            	var DAO = DAO || {};
            	
            	/*Open DB with version+1*/
            	
            	var version = 2;
            	var db = null;
            	document.write("Trying to open database with version", version);
            	try {
            		var dbOpenRequest = window.indexedDB.open("BookShop1", version);
            		dbOpenRequest.onsuccess = function(event){
            			db = dbOpenRequest.result;
            			DAO.version = db.version;
            			db.onversionchange = function(e){
            				write("Version change triggered, so closing database connection", e.oldVersion, e.newVersion);
            				db.close();
            			};
            			write("Database Opened", db, event);
            			/* Code for ${db.open} */
            		};
            		dbOpenRequest.onupgradeneeded = function(e){
            			write("Database upgrade needed");
            			var db = dbOpenRequest.result;
            			
            			write("Changing the database version");
            			// db has been initialized elsewhere                                    
            			
            			write("Database version changed, now trying to create an Index");
            			var objectStore = dbOpenRequest.transaction.objectStore("ObjectStore_BookList");
            			DAO.index = objectStore.createIndex("priceIndex", "price");
            			write("Index created", DAO.index);
            		};
            		dbOpenRequest.onerror = function(e){
            			write("DB Open Request Error");
            		};
            		dbOpenRequest.onblocked = function(e){
            			write("DB Open Request Blocked");
            		};
            	} catch (e) {
            		writeError(e);
            	}
            }
        </script>
    </body>
</html>
