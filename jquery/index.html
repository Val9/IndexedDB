<html>
    <head>
        <title>IndexedDB Jquery Plugin</title>
        <style>
            li {
                padding: 0.2em 1em;
            }
            
            #console {
                clear: both;
                margin: 1em 0 1em 0;
                padding: 0.5em;
                height: 50%;
                overflow-y: scroll;
                border: SOLID 1px GRAY;
            }
            
            #console div {
                padding: 0.2em;
                font-size: 0.8em;
                color: #333333;
            }
            
            #code {
                font-family: courier;
                font-size: 1.5em;
                margin: 1em;
            }
        </style>
    </head>
    <body>
        <div>
            To see more documentation, visit <a href = "/trialtool/index.html#example=/IndexedDB/jquery/trialtool.html">/trialtool/index.html#example=/IndexedDB/jquery/trialtool.html</a>
        </div>
        <ol id = "examples">
        </ol>
        <div id = "code">
            {{ Code will be show here }}
        </div>
        <a href = "javascript:clear()" style ="clear:both; display: block; ">Clear Console</a>
        <div id = "console">
        </div>
        <script src="../jquery.min.js" type="text/javascript">
        </script>
        <script src= "jquery.indexeddb.js" type="text/javascript">
        </script>
        <script charset="utf-8">
            function data(){
                return {
                    "bookName": "bookName-" + parseInt(Math.random() * 100),
                    "price": parseInt(Math.random() * 1000),
                    "checkedOut": new Date()
                }
            };
            function clear(){
                $("#console").empty();
            }
            
            var callback = function(){
                $("#console").append($("<div >").html(JSON.stringify(arguments)));
                //console.info.apply(this, arguments);	
            };
            
            
            var examples = {
                "Set Version": function(){
                    $.indexeddb("BookShop-1").setVersion(callback);
                },
                
                "Transaction": function(){
                    var transaction = $.indexeddb("BookShop-1").transaction([], IDBTransaction.READ_WRITE);
                    transaction.objectStore("BookList").add(data());
                    transaction.objectStore("OldBookList").add(data());
                },
                
                "Create Object Store": function(){
                    $.indexeddb("BookShop-1").createObjectStore("BookList").promise().done(callback);
                },
                
                "Delete Object Store": function(){
                    $.indexeddb("BookShop-1").deleteObjectStore("BookList").promise().done(callback);
                },
                
                "Open Object Store, but dont create if does not exist": function(){
                    $.indexeddb("BookShop-1").objectStore("BookList", false).promise().done(callback);
                },
                
                "Open Object Store, or create if does not exist": function(){
                    $.indexeddb("BookShop-1").objectStore("BookList", true).promise().done(callback);
                },
                
                "Add Data to Object Store": function(){
                    $.indexeddb("BookShop-1").objectStore("BookList").add(data()).promise().done(function(e){
                        objId = e;
                        callback(e)
                    });
                },
                
                "Get data": function(){
                    $.indexeddb("BookShop-1").objectStore("BookList").get(objId).promise().done(callback);
                },
                
                "Modify Data in Object Store": function(){
                    var value = data();
                    value["modified-" + Math.random()] = true;
                    value.id = objId;
                    $.indexeddb("BookShop-1").objectStore("BookList").update(value).promise().done(callback);
                },
                
                "Open a Cursor and list all items in the object store": function(){
                    $.indexeddb("BookShop-1").objectStore("BookList").openCursor().each(callback);
                },
                
                "Open a cursor and delete items with price that is an odd number": function(){
                    $.indexeddb("BookShop-1").objectStore("BookList").openCursor().deleteEach(function(value, key){
                        if (value.price % 2) {
                            return true;
                        }
                    });
                },
                
                "Open a cursor and update items with price that is an odd number": function(){
                    $.indexeddb("BookShop-1").objectStore("BookList").openCursor().updateEach(function(value){
                        if (value.price % 2) {
                            value["modified-" + Math.random()] = true;
                            value.price = parseInt(Math.random() * 100);
                            callback(value);
                            return value;
                        }
                    });
                },
                "Open an Index and iterate over its objects": function(){
                    $.indexeddb("BookShop-1").objectStore("BookList").index("price").openCursor().each(callback);
                },
                "Open a key cursor on an Index and iterate over its objects": function(){
                    $.indexeddb("BookShop-1").objectStore("BookList").index("price").openKeyCursor([200, 500]).each(callback);
                },
                
                "TODO": function(){
                    $.indexeddb().open("BookShop-1").objectStore("BookList", false).openCursor();
                    $.indexeddb().open("BookShop-1").objectStore("BookList", "noCreate").openCursor();
                    $.indexeddb().open("BookShop-1").objectStore("BookList").openIndex();
                    $.indexeddb().open("BookShop-1").objectStore("BookList").createIndexIndex();
                    
                }
            };
            
            
            for (example in examples) {
                $("#examples").append($("<li><a class = 'command' href = 'javascript:clear();examples[\"" + example + "\"]()'>" + example + "</a></li>"));
            }
            
            $(".command").live("click", function(){
                var code = examples[$(this).html()].toString();
                var start = "function (){";
                code = code.substring(code.indexOf(start) + start.length + 2, code.length - 1);
                $("#code").html(code);
            });
        </script>
    </body>
</html>
