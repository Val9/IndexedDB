<html>
    <head>
        <title>Jquery IndexedDB Plugin</title>
        <script>
            function data(){
                return {
                    "bookName": "bookName-" + parseInt(Math.random() * 100),
                    "price": parseInt(Math.random() * 1000),
                    "checkedOut": new Date()
                }
            };
        </script>
        <script src = "/IndexedDB/jquery/jquery.indexeddb.js" type="text/javascript">
        </script>
    </head>
    <body>
        <div class = "splash">
            <h2>Jquery IndexedDB Plugin</h2>
            <p>
                The examples listed here illustrate the use of IndexedDB Jquery plugin.
            </p>
        </div>
        <ul>
            <li class="example-set">
                <a class = "example-set-name" href = "#">Database</a>
                <ul>
                    <li class = "example">
                        <a class = "example-name">Open Database</a>
                        <script type="text/javascript">
                            $.indexeddb("BookShop-1").promise().then(write, writeError);
                        </script>
                    </li>
                    <li class = "example">
                        <a class = "example-name" href = "#">Database properties</a>
                        <script type="text/javascript">
                            $.indexeddb("BookShop-1").promise().then(function(db){
                                write("Current Database", db);
                                write("Database version", db.version);
                            }, writeError);
                        </script>
                    </li>
                    <li class = "example">
                        <a class = "example-name">Set Version</a>
                        <script type="text/javascript">
                            // The second argument is optional. If not specified, the version is incremented by 1
                            $.indexeddb("BookShop-1").setVersion(write, 10);
                        </script>
                    </li>
                </ul>
            </li>
            <li class="example-set">
                <a class = "example-set-name">Object Store</a>
                <ul>
                    <li class = "example">
                        <a class = "example-name">Transaction</a>
                        <script type="text/javascript">
                            var transaction = $.indexeddb("BookShop-1").transaction([], IDBTransaction.READ_WRITE);
                            transaction.objectStore("BookList").add(data()).promise().then(write, writeError);
                            transaction.objectStore("OldBookList").add(data()).promise().then(write, writeError);
                        </script>
                    </li>
                    <li class = "example">
                        <a class = "example-name">Open Object Store, but don't create</a>
                        <script type="text/javascript">
                            // A false in the Object store indicates that the object store should not be created if it does not exist.
                            $.indexeddb("BookShop-1").objectStore("BookList", false).promise().then(write, writeError);
                        </script>
                    </li>
                    <li class = "example" id = "objectStore">
                        <a class = "example-name">Create or Open Object Store</a>
                        <script type="text/javascript">
                            // A false in the Object store indicates that the object store should not be created if it does not exist.
                            $.indexeddb("BookShop-1").objectStore("BookList", {
                                "keyPath": "id",
                                "autoIncrement": true
                            }).promise().then(write, writeError);
                        </script>
                    </li>
                    <li class = "example">
                        <a class = "example-name">Delete object Store</a>
                        <script type="text/javascript">
                            // A false in the Object store indicates that the object store should not be created if it does not exist.
                            $.indexeddb("BookShop-1").deleteObjectStore("BookList", false).promise().then(write, writeError);
                        </script>
                    </li>
                    <li class="example-set">
                        <a class = "example-set-name">CRUD on Object Store</a>
                        <ul>
                            <li class = "example" depends = "objectStore" id = "add">
                                <a class = "example-name">Add data to object store</a>
                                <script type="text/javascript">
                                    var book = data();
                                    $.indexeddb("BookShop-1").objectStore("BookList").add(book).promise().then(function(e){
                                        book.id = e;
                                        write(e);
                                    }, writeError);
                                </script>
                            </li>
                            <li class = "example" depends = "add">
                                <a class = "example-name">Get data from object store</a>
                                <script type="text/javascript">
                                    $.indexeddb("BookShop-1").objectStore("BookList").get(book.id).promise().then(write, writeError);
                                </script>
                            </li>
                            <li class = "example" depends = "add">
                                <a class = "example-name">Modify data in object store</a>
                                <script type="text/javascript">
                                    book["modified" + Math.random()] = true;
                                    $.indexeddb("BookShop-1").objectStore("BookList").update(book).promise().then(write, writeError);
                                </script>
                            </li>
                            <li class = "example" depends = "add">
                                <a class = "example-name">Removes object from object store</a>
                                <script type="text/javascript">
                                    $.indexeddb("BookShop-1").objectStore("BookList").remove(book.id).promise().then(write, writeError);
                                </script>
                            </li>
                        </ul>
                    </li>
                </ul>
            </li>
            <li class="example-set">
                <a class = "example-set-name">Cursors</a>
                <ul>
                    <li class = "example">
                        <a class = "example-name">Iterate over all objects using cursors</a>
                        <script type = "text/javascript">
                            $.indexeddb("BookShop-1").objectStore("BookList").openCursor().each(write);
                        </script>
                    </li>
                    <li class = "example">
                        <a class = "example-name">Update some objects</a>
                        <script type = "text/javascript">
                            $.indexeddb("BookShop-1").objectStore("BookList").openCursor().updateEach(function(value){
                                if (parseInt(Math.random() * 10 % 2)) {
                                    value["modified-" + Math.random()] = true;
                                    write("Updating", value);
                                    return value;
                                }
                            });
                        </script>
                    </li>
                    <li class = "example">
                        <a class = "example-name">Delete some objects</a>
                        <script type = "text/javascript">
                            $.indexeddb("BookShop-1").objectStore("BookList").openCursor().deleteEach(function(value, key){
                                if (parseInt(Math.random() * 10 % 2)) {
                                    write("Deleting", value);
                                    return true;
                                }
                            });
                        </script>
                    </li>
                </ul>
            </li>
            <li class="example-set">
                <a class = "example-set-name">Indexes</a>
                <ul>
                    <li class = "example">
                        <a class = "example-name">Open Index and iterate</a>
                        <script type = "text/javascript">
                            $.indexeddb("BookShop-1").objectStore("BookList").index("price").openCursor().each(write);
                        </script>
                    </li>
                    <li class = "example">
                        <a class = "example-name">Key cursor on index</a>
                        <script type = "text/javascript">
                            $.indexeddb("BookShop-1").objectStore("BookList").index("price").openKeyCursor([200, 500]).each(write);
                        </script>
                    </li>
                </ul>
            </li>
        </ul>
        <div>
            <div class = "example-docs">
                <h3>Set the version of the database</h3>
                <p>
                    This method is used to set the version of the database. The second (optional) argument to this function is the version number.
                    <br/>
                    If version number is not specified, the version is automatically incremented by 1. 
                </p>
                <p>
                    Internally, a version change transaction is opened and the version is changed. Note that this operation may fail if active transactiosn are pending against the database.
                    You may have to close the database and then invoke this operation.
                </p>
            </div>
            <div class = "example-docs">
                <h3>Open Object Store</h3>
                <p>
                    Opens or creates an object store. The objectStore function takes 2 arguments
                    <ol>
                        <li>
                            Name of the object store
                        </li>
                        <li>
                            Create options. 
                            <ul>
                                <li>
                                    Object - create object store with object that has values for keyPath and autoIncrement
                                </li>
                                <li>
                                    True - create object store with "id" as keyPath and autoIncrement it.
                                </li>
                                <li>
                                    Undefined or not specified - create object store with "id" as keyPath and autoIncrement it.
                                </li>
                                <li>
                                    False - don't create object store if it does not exist
                                </li>
                            </ul>
                        </li>
                    </ol>
                </p>
            </div>
        </div>
    </body>
</html>
