<html>
    <head>
        <title>IndexedDB Jquery Plugin</title>
        <style>
            li {
                padding: 0.2em 1em;
            }
            
            #console {
                clear: both;
                margin: 1em 0 1em 0;
                padding: 0.5em;
                height: 50%;
                overflow-y: scroll;
                border: SOLID 1px GRAY;
            }
            
            #console div {
                padding: 0.2em;
                font-size: 0.8em;
                color: #333333;
            }
            
            #code {
                font-family: courier;
                font-size: 1.5em;
                margin: 1em;
            }
        </style>
    </head>
    <body>
        <ol id = "examples">
        </ol>
        <div id = "code">
            {{ Code will be show here }}
        </div>
        <a href = "javascript:clear()" style ="clear:both; display: block; ">Clear Console</a>
        <div id = "console">
        </div>
        <script src="../jquery.min.js" type="text/javascript">
        </script>
        <script src= "jquery.indexeddb.js" type="text/javascript">
        </script>
        <script charset="utf-8">
            function data(){
                return {
                    "bookName": "bookName-" + parseInt(Math.random() * 100),
                    "price": parseInt(Math.random() * 1000),
                    "checkedOut": new Date()
                }
            };
            function clear(){
                $("#console").empty();
            }
            
            var callback = function(){
                $("#console").append($("<div >").html(JSON.stringify(arguments)));
                //console.info.apply(this, arguments);	
            };
            
            
            var examples = {
                "Get Version": function(){
                    $.indexeddb("BookShop-1").getVersion(callback);
                },
                
                "Set Version": function(){
                    $.indexeddb("BookShop-1").setVersion(callback);
                },
                
                "Transaction": function(){
                    var transaction = $.indexeddb("BookShop-1").transaction(["BookList"], IDBTransaction.READ_WRITE);
                    transaction.objectStore("BookList").put(data());
                    transaction.objectStore("OldBookList").put(data());
                },
                
                "Create Object Store": function(){
                    $.indexeddb("BookShop-1").createObjectStore("BookList").done(callback);
                },
                
                "Delete Object Store": function(){
                    $.indexeddb("BookShop-1").deleteObjectStore("BookList").done(callback);
                },
                
                "Open Object Store, but dont create if does not exist": function(){
                    $.indexeddb("BookShop-1").objectStore("BookList", false).done(callback);
                },
                
                "Open Object Store, or create if does not exist": function(){
                    $.indexeddb("BookShop-1").objectStore("BookList", true).done(callback);
                },
                
                "Add Data to Object Store": function(){
                    $.indexeddb("BookShop-1").objectStore("BookList").add(data()).done(callback);
                },
                
                "Modify Data in Object Store": function(){
                    $.indexeddb("BookShop-1").objectStore("BookList").update(data()).done(callback);
                },
                
                "Open a Cursor and list all items in the object store": function(){
                    $.indexeddb("BookShop-1").objectStore("BookList").openCursor().each(callback);
                },
                
                "TODO": function(){
                    $.indexeddb().open("BookShop-1").objectStore("BookList", false).openCursor();
                    $.indexeddb().open("BookShop-1").objectStore("BookList", "noCreate").openCursor();
                    $.indexeddb().open("BookShop-1").objectStore("BookList").openIndex();
                    $.indexeddb().open("BookShop-1").objectStore("BookList").createIndexIndex();
                    
                }
            };
            
            
            for (example in examples) {
                $("#examples").append($("<li><a class = 'command' href = 'javascript:clear();examples[\"" + example + "\"]()'>" + example + "</a></li>"));
            }
            
            $(".command").live("click", function(){
                var code = examples[$(this).html()].toString();
                var start = "function (){";
                code = code.substring(code.indexOf(start) + start.length + 2, code.length - 1);
                $("#code").html(code);
            });
        </script>
    </body>
</html>
